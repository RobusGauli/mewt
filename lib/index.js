let a=Array.isArray,o=(b)=>'object'==typeof b,k=(b)=>a(b)?Object.keys([...b]):Object.keys(b),M=module.exports=(b,c=[])=>{if('object'!=typeof b)throw new Error('expect arr|obj');let d,e=(l,m)=>{for(d=c.length;d>(m?1:0);)l=l[c[--d]];return m?void(l[c[--d]]=m):l},f=e(b),g=a(f),h=(l=b)=>o(l)?k(l).reduce((m,n)=>(d=l[n],m[n]=a(d)?d.map(h):o(d)?h(d):d,m),a(l)?[]:{}):l,i=()=>{throw new Error((g?'arr':'obj')+' immutable')},j=(l)=>(...m)=>{let n=/reverse|sort|splice|fill|copyWithin/.test(l),p=/filter|map|concat|slice/.test(l),q=p?b:h(),r=e(q)[l](...m);return d=n||p?M(r):r,/push|pop|shift|unshift/.test(l)?[d,M(q)]:d};return c.length||(b=k(b).reduce((l,m)=>(l[m]=o(f[m])?M(b,[...c,m]):f[m],l),a(b)?[]:{})),new Proxy(f,{get(l,m){let n;return d=e(b),{$set(p,q){return n=h(),d=e(n),d[p]=q,M(n)},$unset(p){return(n=h(),g&&!(p%1)&&0<=p)?(d=[...n.slice(0,p),...n.slice(p+1)],c.length?(e(n,d),M(n)):M(d)):(delete e(n)[p],M(n))}}[m]||d[m]&&({}.hasOwnProperty.call(d,m)?d[m]:j(m))},defineProperty:i,deleteProperty:i,setPrototypeOf:i})};